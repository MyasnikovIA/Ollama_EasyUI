<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ollama Web Client</title>
    <link rel="stylesheet" type="text/css" href="https://www.jeasyui.com/easyui/themes/default/easyui.css">
    <link rel="stylesheet" type="text/css" href="https://www.jeasyui.com/easyui/themes/icon.css">
    <link rel="stylesheet" type="text/css" href="https://www.jeasyui.com/easyui/themes/color.css">
    <link rel="stylesheet" type="text/css" href="style.css">
    <!-- Библиотека для подсветки синтаксиса -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div style="display:flex;align-items:center;justify-content:space-between;width:100%;">
                <h1>Ollama Web Client</h1>
                <div style="display:flex;align-items:center;gap:10px;">
                    <div id="status-bar">
                        <span class="status-indicator status-disconnected"></span>
                        <span>Не подключено</span>
                    </div>
                    <a href="#" class="easyui-menubutton"
                       data-options="menu:'#header-menu',iconCls:'icon-more',hasDownArrow:true">Меню</a>
                </div>
            </div>
        </div>

        <!-- Меню для header -->
        <div id="header-menu" style="width:200px;">
            <div data-options="iconCls:'icon-settings'" onclick="openSettingsDialog()">Настройки API</div>
            <div data-options="iconCls:'icon-prompt'" onclick="openPromptsDialog()">Промпты</div>
            <div class="menu-separator"></div>
            <div data-options="iconCls:'icon-clear'" onclick="clearChat()">Очистить чат</div>
            <div data-options="iconCls:'icon-reload'" onclick="loadSettings()">Сбросить настройки</div>
            <div class="menu-separator"></div>
            <div data-options="iconCls:'icon-connect'" onclick="testConnection()">Тест подключения</div>
        </div>

        <!-- Main Layout with Split -->
        <div id="main-split" class="easyui-layout" style="width:100%;height:calc(100vh - 80px);">
            <!-- Left Panel: Chat History -->
            <div data-options="region:'west',split:true,title:'История чатов',width:'30%',minWidth:200,maxWidth:500"
                 style="padding:10px;">
                <ul id="chat-history" class="easyui-tree" style="width:100%;height:100%;"></ul>
            </div>
            <!-- Контекстное меню для дерева истории -->
            <div id="history-context-menu" style="width:120px;display:none;">
                <div onclick="deleteChat()" data-options="iconCls:'icon-remove'">Удалить чат</div>
                <div onclick="clearAllHistory()" data-options="iconCls:'icon-clear'">Очистить историю</div>
            </div>

            <!-- Center Panel: Chat Interface -->
            <div data-options="region:'center',title:'Чат'" style="padding:10px;">
                <div id="main-chat-split" class="easyui-layout" style="width:100%;height:100%;">
                    <!-- Верхняя панель: Сообщения -->
                    <div data-options="region:'center',border:false" style="padding:0;">
                        <div id="chat-messages" class="response-area">
                            <!-- Сообщения будут добавляться здесь -->
                        </div>
                    </div>

                    <!-- Нижняя панель: Ввод сообщения -->
                    <div data-options="region:'south',split:true,height:'30%',minHeight:150,maxHeight:400,border:false" style="padding:10px 0 0 0;">
                        <div class="chat-input-container" style="height:100%;">
                            <textarea id="message-input" class="easyui-textbox easyui-fluid"
                                data-options="multiline:true,prompt:'Введите сообщение...'"
                                style="width:100%;height:calc(100% - 60px);"></textarea>

                            <div class="chat-buttons">
                                <a href="javascript:void(0)" class="easyui-linkbutton" onclick="sendMessage()"
                                   data-options="iconCls:'icon-send',size:'large'">Отправить</a>
                                <a href="javascript:void(0)" class="easyui-linkbutton" onclick="testConnection()"
                                   data-options="iconCls:'icon-connect'">Тест подключения</a>
                            </div>

                            <div id="typing-indicator" class="typing-indicator" style="display:none">
                                AI печатает...
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Dialog for Settings -->
    <div id="settings-dialog" class="easyui-dialog" title="Настройки API"
         style="width:500px;height:450px;padding:20px"
         data-options="
            closed:true,
            modal:true,
            buttons:[{
                text:'Сохранить',
                iconCls:'icon-save',
                handler:saveSettings
            },{
                text:'Отмена',
                iconCls:'icon-cancel',
                handler:function(){$('#settings-dialog').dialog('close');}
            }]">
        <div class="settings-form" style="margin-top:10px;">
            <div class="form-field" style="margin-bottom:15px;">
                <label style="display:block;margin-bottom:5px;font-weight:bold;">Ollama URL:</label>
                <input id="ollama-url" class="easyui-textbox" style="width:100%;height:32px;">
            </div>

            <div class="form-field" style="margin-bottom:15px;">
                <label style="display:block;margin-bottom:5px;font-weight:bold;">Режим API:</label>
                <select id="api-mode" class="easyui-combobox" style="width:100%;height:32px;"
                    data-options="
                        value:'chat',
                        data:[
                            {value:'chat', text:'Chat (/api/chat)'},
                            {value:'generate', text:'Generate (/api/generate)'}
                        ]">
                </select>
            </div>

            <div class="form-field" style="margin-bottom:15px;">
                <label style="display:block;margin-bottom:5px;font-weight:bold;">Модель:</label>
                <select id="model" class="easyui-combobox" style="width:100%;height:32px;"
                    data-options="
                        valueField:'name',
                        textField:'name',
                        value:'llama2'">
                </select>
            </div>

            <div class="form-field" style="margin-bottom:15px;">
                <label style="display:block;margin-bottom:5px;font-weight:bold;">Температура:</label>
                <input id="temperature" class="easyui-numberspinner" style="width:100%;height:32px;"
                    data-options="
                        min:0,
                        max:2,
                        step:0.1,
                        value:0.7,
                        precision:0.1">
            </div>

            <div class="form-field" style="margin-bottom:15px;">
                <label style="display:block;margin-bottom:5px;font-weight:bold;">Context Length:</label>
                <input id="context-length" class="easyui-numberspinner" style="width:100%;height:32px;"
                    data-options="
                        min:512,
                        max:8192,
                        value:2048,
                        increment:256">
            </div>
        </div>
    </div>

    <!-- Modal Dialog for Prompts -->
    <div id="prompts-dialog" class="easyui-dialog" title="Настройка промптов"
         style="width:700px;height:500px;padding:10px"
         data-options="
            closed:true,
            modal:true,
            buttons:[{
                text:'Сохранить',
                iconCls:'icon-save',
                handler:savePrompts
            },{
                text:'Отмена',
                iconCls:'icon-cancel',
                handler:function(){$('#prompts-dialog').dialog('close');}
            }]">
        <div class="easyui-tabs" style="width:100%;height:100%;">
            <div title="Chat промпт" style="padding:10px;">
                <textarea id="chat-prompt" class="easyui-textbox"
                         data-options="multiline:true,prompt:'Введите промпт для Chat режима...'"
                         style="width:100%;height:350px"></textarea>
            </div>
            <div title="Generate промпт" style="padding:10px;">
                <textarea id="generate-prompt" class="easyui-textbox"
                         data-options="multiline:true,prompt:'Введите промпт для Generate режима...'"
                         style="width:100%;height:350px"></textarea>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script type="text/javascript" src="https://www.jeasyui.com/easyui/jquery.easyui.min.js"></script>
    <script type="text/javascript" src="script.js"></script>
</body>
</html>